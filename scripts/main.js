!function(){"use strict";function a(){L=new THREE.Scene,M=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,3e3),M.position.z=-4,M.position.x=60,M.position.y=11,M.lookAt({x:0,y:5,z:-3}),N=new THREE.WebGLRenderer,N.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(N.domElement),P=new THREE.PointLight(11184810,.75),P.position.set(-50,100,0),P.position.multiplyScalar(300),L.add(P),O=new THREE.AmbientLight(10066329),L.add(O),g(L),h(),j(),k(),m(),l(),n(),i(),window.addEventListener("resize",c,!1),$(window).keypress(function(a){32==a.which&&Y>=X&&(W?C&&C.position.y<40&&la>0?(V.play(),ba=ca>90||-90>ca?.3:.2):b():($("#ui-start").hide(),W=!0,f()))}),$(window).keyup(function(a){32==a.which&&b()}),W=!1,d()}function b(){V.pause(),ba=-.2}function c(){M.aspect=window.innerWidth/window.innerHeight,M.updateProjectionMatrix(),N.setSize(window.innerWidth,window.innerHeight)}function d(){requestAnimationFrame(d);var a=oa.getDelta();THREE.AnimationHandler.update(3*a),W&&y(),N.render(L,M)}function e(){Y++,Y>=X&&($("#loading").fadeOut(),$("#score").fadeIn(),o(),z())}function f(){for(var a=0;a<Z.length;a++)for(var b=0;b<Z[a].length;b++)L.remove(Z[a][b].element);Z.length=0,fa=0,ga=0,ha=0,ia=0,ja=0,o(),C.position.y=8,C.scale.set(.5,.5,.5),C.position.x=da,C.rotation.y=Math.PI,ca=0,aa=0,ka=0,la=100,$("#show")[0].innerHTML="0"}function g(a){var b=["images/pics/0004.png","images/pics/0002.png","images/pics/0006.png","images/pics/0005.png","images/pics/0001.png","images/pics/0003.png"],c=THREE.ImageUtils.loadTextureCube(b);c.format=THREE.RGBFormat;var d=THREE.ShaderLib.cube;d.uniforms.tCube.value=c;var e=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms,depthWrite:!1,side:THREE.BackSide});E=new THREE.Mesh(new THREE.BoxGeometry(1e3,1e3,1e3),e),a.add(E)}function h(){var a=new THREE.JSONLoader;a.load("images/model/plane.json",function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.skinning=!0}C=new THREE.SkinnedMesh(a,new THREE.MeshFaceMaterial(b)),C.position.y=8;var f=new THREE.Animation(C,C.geometry.animations[0]);f.play(),C.scale.set(.5,.5,.5),C.position.x=da,C.rotation.y=Math.PI,L.add(C),e()})}function i(){$.getJSON("images/map/map.json",function(a){Q=a,e()})}function j(){var a=new THREE.JSONLoader;a.load("images/model/island.json",function(a,b){D=new THREE.Mesh(a,new THREE.MeshFaceMaterial(b)),D.scale.set(10,10,10),D.position.y=-5,L.add(D),e()})}function k(){var a=new THREE.JSONLoader;a.load("images/model/bonus.json",function(a,b){J=a,K=new THREE.MeshFaceMaterial(b),e()})}function l(){var a=new THREE.JSONLoader;a.load("images/model/stone.json",function(a,b){F=a,G=new THREE.MeshFaceMaterial(b),e()})}function m(){var a=new THREE.JSONLoader;a.load("images/model/point.json",function(a,b){H=a,I=new THREE.MeshFaceMaterial(b),e()})}function n(){R=document.createElement("audio"),R.src="images/music/note_2.mp3",S=document.createElement("audio"),S.src="images/music/megagem_6.mp3",T=document.createElement("audio"),T.src="images/music/cloud_hit.mp3",U=document.createElement("audio"),U.src="images/music/ground_hit.mp3",V=document.createElement("audio"),V.src="images/music/engine.mp3",V.setAttribute("loop",!0)}function o(){for(var a=0;130>a;a++){var b=new THREE.Mesh(F,G);b.position.x=da*Math.cos(2*Math.PI*a/130),b.position.z=da*Math.sin(2*Math.PI*a/130),b.position.y=-10,L.add(b);var c={type:1,element:b},d=[];d.push(c),Z.push(d)}}function p(){50>ka?0!=fa&&(fa=0,ia=0):130>ka?1!=fa&&(fa=1,ia=0):2!=fa&&(fa=2,ia=0)}function q(){la-=.03,na.fillStyle="#000000",na.fillRect(0,0,300,200),na.fillStyle="#FF0000",na.fillRect(0,0,3*la,200),la>10?$("#no-fuel").hide():$("#no-fuel").show(),0>la&&(la=0),la>100&&(la=100)}function r(){aa+=ba,ba>=.3&&-2.5>aa?aa=-2.5:ba>=.3&&aa>2.5?aa=2.5:ca>90&&aa>1&&0>ba?aa=1:-1>aa?aa=-1:aa>1.5&&(aa=1.5),ca>=-90&&90>=ca?ca+=aa:(ca+=Math.abs(aa),ca>=180&&(ca=-179)),0>ba&&ca>=-90+aa&&-90-aa>=ca&&(ca=-90)}function s(){C.position.y+=Math.sin(ca*Math.PI/180)*_,C.position.y<=0&&(C.position.y=0,A()),C.rotation.x=ca*Math.PI/180,(C.rotation.z>=.1||C.rotation.z<=-.1)&&(ea=-ea);var a=Math.min(.001,Math.max(5e-4,(.1-Math.abs(C.rotation.z))/.1*.005));C.rotation.z+=ea*a}function t(){var a=1.1*C.position.y;0>a&&(a=0),M.position.y=a}function u(){D.rotation.y-=Math.atan(_*Math.cos(ca*Math.PI/180)/da)}function v(){P.position.x=50*-Math.cos(D.rotation.y),P.position.z=50*Math.sin(D.rotation.y)}function w(a){for(var b=Math.cos(D.rotation.y+2*Math.PI*a/Z.length),c=Math.sin(D.rotation.y+2*Math.PI*a/Z.length),d=0;d<Z[a].length;d++)Z[a][d].element.position.x>48&&Z[a][d].element.position.z>-2&&Z[a][d].element.position.z<2&&(1==Z[a][d].type&&Math.abs(Z[a][d].element.position.y-C.position.y)<1.5||2==Z[a][d].type&&Math.abs(Z[a][d].element.position.y-C.position.y)<1||3==Z[a][d].type&&Math.abs(Z[a][d].element.position.y-C.position.y)<1)?(3==Z[a][d].type?ka++:1==Z[a][d].type?la-=10:la+=10,$("#show")[0].innerHTML=ka,L.remove(Z[a][d].element),B(Z[a][d]),Z[a].splice(d,1)):(Z[a][d].element.position.x=-b*da,Z[a][d].element.position.z=c*da,Z[a][d].element.rotation.y=D.rotation.y+2*Math.PI*a/Z.length+Math.PI)}function x(a){var b=Math.cos(D.rotation.y+2*Math.PI*a/Z.length),c=Math.sin(D.rotation.y+2*Math.PI*a/Z.length);if(-40>-b*da&&10>c*da&&c*da>0&&Z[a].length>0){for(var d=0;d<Z[a].length;d++)L.remove(Z[a][d].element);Z[a].length=0}else if(-40>-b*da&&c*da>-10&&0>c*da&&0==Z[a].length)if(4>=ia){var e=new THREE.Mesh(F,G);L.add(e);var f={type:1,element:e};e.position.y=-10,Z[a].push(f),ia++}else if(Q[fa][ga].length<=ha)ia=0,ga=Math.floor(Math.random()/.34),ha=0,ja=6*(Math.random()-.5);else{for(var g=0;g<Q[fa][ga][ha].length;g++){var h,i;1==Q[fa][ga][ha][g].type?(h=new THREE.Mesh(F,G),L.add(h),i={type:1,element:h}):2==Q[fa][ga][ha][g].type?(h=new THREE.Mesh(J,K),L.add(h),i={type:2,element:h}):(h=new THREE.Mesh(H,I),L.add(h),i={type:3,element:h}),h.position.y=Q[fa][ga][ha][g].h+ja,Z[a].push(i)}ha++}}function y(){if(p(),q(),W&&r(),Y>=X){for(var a=0;a<Z.length;a++)x(a),w(a);v(),s(),t(),u()}}function z(){var a=$("#ui-start");$("#no-fuel").hide(),a.fadeIn()}function A(){W=!1,U.play(),z()}function B(a){3==a.type?R.play():2==a.type?S.play():T.play()}var C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=6,Y=0,Z=[],_=.15,aa=0,ba=-1,ca=0,da=50,ea=1,fa=0,ga=0,ha=0,ia=0,ja=0,ka=0,la=100,ma=document.getElementById("bar"),na=ma.getContext("2d"),oa=new THREE.Clock;a()}();