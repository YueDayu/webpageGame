!function(){"use strict";function a(a){var b=["images/pics/0004.png","images/pics/0002.png","images/pics/0006.png","images/pics/0005.png","images/pics/0001.png","images/pics/0003.png"],c=THREE.ImageUtils.loadTextureCube(b);c.format=THREE.RGBFormat;var d=THREE.ShaderLib.cube;d.uniforms.tCube.value=c;var e=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms,depthWrite:!1,side:THREE.BackSide});t=new THREE.Mesh(new THREE.BoxGeometry(1e3,1e3,1e3),e),a.add(t)}function b(){G++,G>=F&&($("#loading").fadeOut(),$("#score").fadeIn(),j(),o())}function c(){$("#ui-start").fadeOut(),A=new THREE.Scene,B=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,3e3),B.position.z=-4,B.position.x=60,B.position.y=10,B.lookAt({x:0,y:10,z:0}),C=new THREE.WebGLRenderer,C.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(C.domElement),E=new THREE.PointLight(11184810,.75),E.position.set(100,100,0),E.position.multiplyScalar(300),A.add(E),D=new THREE.AmbientLight(10066329),A.add(D),a(A),d(),f(),g(),i(),h(),n(),window.addEventListener("resize",m,!1),$(window).keydown(function(a){32==a.which&&G>=F&&(ba?U>0&&(aa.play(),r&&r.position.y<40&&(K=L>90||-90>L?.3:.2)):($("#ui-start").hide(),ba=!0,e()))}),$(window).keyup(function(a){32==a.which&&(aa.pause(),K=-.2)}),ba=!1,l()}function d(){var a=new THREE.JSONLoader;a.load("images/model/plane.json",function(a,c){for(var d=0;d<c.length;d++){var e=c[d];e.skinning=!0}r=new THREE.SkinnedMesh(a,new THREE.MeshFaceMaterial(c)),r.position.y=8;var f=new THREE.Animation(r,r.geometry.animations[0]);f.play(),r.scale.set(.5,.5,.5),r.position.x=M,r.rotation.y=Math.PI,A.add(r),b()})}function e(){for(var a=0;a<H.length;a++)for(var b=0;b<H[a].length;b++)A.remove(H[a][b].element);H.length=0,O=0,P=0,Q=0,R=0,S=0,j(),r.position.y=8,r.scale.set(.5,.5,.5),r.position.x=M,r.rotation.y=Math.PI,L=0,J=0,T=0,U=100,$("#show")[0].innerHTML="0"}function f(){var a=new THREE.JSONLoader;a.load("images/model/island.json",function(a,c){s=new THREE.Mesh(a,new THREE.MeshFaceMaterial(c)),s.scale.set(10,10,10),s.position.y=-5,A.add(s),b()})}function g(){var a=new THREE.JSONLoader;a.load("images/model/bonus.json",function(a,c){y=a,z=new THREE.MeshFaceMaterial(c),b()})}function h(){var a=new THREE.JSONLoader;a.load("images/model/stone.json",function(a,c){u=a,v=new THREE.MeshFaceMaterial(c),b()})}function i(){var a=new THREE.JSONLoader;a.load("images/model/point.json",function(a,c){w=a,x=new THREE.MeshFaceMaterial(c),b()})}function j(){for(var a=0;130>a;a++){var b=new THREE.Mesh(u,v);b.position.x=M*Math.cos(2*Math.PI*a/130),b.position.z=M*Math.sin(2*Math.PI*a/130),b.position.y=-10,A.add(b);var c={type:1,element:b},d=[];d.push(c),H.push(d)}}function k(){if(O=50>T?0:130>T?1:2,U-=.03,W.fillStyle="#000000",W.fillRect(0,0,300,200),W.fillStyle="#FF0000",W.fillRect(0,0,3*U,200),U>10?$("#no-fuel").hide():$("#no-fuel").show(),J+=K,K>=.3&&-2.5>J?J=-2.5:K>=.3&&J>2.5?J=2.5:L>90&&J>1&&0>K?J=1:-1>J?J=-1:J>1.5&&(J=1.5),L>=-90&&90>=L?L+=J:(L+=Math.abs(J),L>=180&&(L=-179)),0>K&&L>=-90+J&&-90-J>=L&&(L=-90),G>=F){var a=Math.atan(I*Math.cos(L*Math.PI/180)/M);s.rotation.y-=a,E.position.x=50*-Math.cos(s.rotation.y),E.position.z=50*Math.sin(s.rotation.y);for(var b=0;b<H.length;b++){var c=Math.cos(s.rotation.y+2*Math.PI*b/H.length),d=Math.sin(s.rotation.y+2*Math.PI*b/H.length);if(-40>-c*M&&10>d*M&&d*M>0&&H[b].length>0){for(var e=0;e<H[b].length;e++)A.remove(H[b][e].element);H[b].length=0}else if(-40>-c*M&&d*M>-10&&0>d*M&&0==H[b].length)if(4>=R){var f=new THREE.Mesh(u,v);A.add(f);var g={type:1,element:f};f.position.y=-10,H[b].push(g),R++}else if(ca[O][P].length<=Q)R=0,P=Math.floor(Math.random()/.34),Q=0,S=6*(Math.random()-.5);else{for(var e=0;e<ca[O][P][Q].length;e++){var f,g;1==ca[O][P][Q][e].type?(f=new THREE.Mesh(u,v),A.add(f),g={type:1,element:f}):2==ca[O][P][Q][e].type?(f=new THREE.Mesh(y,z),A.add(f),g={type:2,element:f}):(f=new THREE.Mesh(w,x),A.add(f),g={type:3,element:f}),f.position.y=ca[O][P][Q][e].h+S,H[b].push(g)}Q++}for(var e=0;e<H[b].length;e++)H[b][e].element.position.x>48&&H[b][e].element.position.z>-2&&H[b][e].element.position.z<2&&(1==H[b][e].type&&Math.abs(H[b][e].element.position.y-r.position.y)<1.5||2==H[b][e].type&&Math.abs(H[b][e].element.position.y-r.position.y)<1||3==H[b][e].type&&Math.abs(H[b][e].element.position.y-r.position.y)<1)?(3==H[b][e].type?T++:1==H[b][e].type?U-=10:U+=10,$("#show")[0].innerHTML=T,A.remove(H[b][e].element),q(H[b][e]),H[b].splice(e,1)):(H[b][e].element.position.x=-c*M,H[b][e].element.position.z=d*M,H[b][e].element.rotation.y=s.rotation.y+2*Math.PI*b/H.length+Math.PI)}r.position.y+=Math.sin(L*Math.PI/180)*I,r.position.y<=0&&(r.position.y=0,p()),r.rotation.x=L*Math.PI/180;var h=1.1*r.position.y;0>h&&(h=0),B.position.y=h,(r.rotation.z>=.1||r.rotation.z<=-.1)&&(N=-N);var i=Math.min(.001,Math.max(5e-4,(.1-Math.abs(r.rotation.z))/.1*.005));r.rotation.z+=N*i}}function l(){requestAnimationFrame(l);var a=da.getDelta();THREE.AnimationHandler.update(3*a),ba&&k(),C.render(A,B)}function m(){B.aspect=window.innerWidth/window.innerHeight,B.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight)}function n(){X=document.createElement("audio"),X.src="images/music/note_2.mp3",Y=document.createElement("audio"),Y.src="images/music/megagem_6.mp3",Z=document.createElement("audio"),Z.src="images/music/cloud_hit.mp3",_=document.createElement("audio"),_.src="images/music/ground_hit.mp3",aa=document.createElement("audio"),aa.src="images/music/engine.mp3",aa.setAttribute("loop",!0)}function o(){var a=$("#ui-start");$("#no-fuel").hide(),a.fadeIn()}function p(){ba=!1,_.play(),o()}function q(a){3==a.type?X.play():2==a.type?Y.play():Z.play()}var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=5,G=0,H=[],I=.15,J=0,K=-1,L=0,M=50,N=1,O=0,P=0,Q=0,R=0,S=0,T=0,U=100,V=document.getElementById("bar"),W=V.getContext("2d");W.fillStyle="#FF0000",W.fillRect(0,0,300,200);var X,Y,Z,_,aa,ba,ca=[[[[{type:3,h:10}],[{type:3,h:12}],[{type:3,h:14}],[{type:3,h:15}],[{type:3,h:15.5},{type:1,h:11}],[{type:3,h:15}],[{type:3,h:14}],[{type:3,h:12}],[{type:2,h:10}]],[[{type:3,h:13}],[{type:3,h:14}],[{type:3,h:15}],[{type:3,h:16}],[{type:3,h:17},{type:1,h:21}],[{type:3,h:18}],[{type:3,h:19}],[{type:2,h:20},{type:1,h:16}],[{type:3,h:19}],[{type:3,h:18}],[{type:3,h:17},{type:1,h:21}],[{type:3,h:16}],[{type:3,h:15}],[{type:3,h:14}],[{type:3,h:13}]],[[{type:3,h:10}],[{type:3,h:12}],[{type:3,h:14}],[{type:3,h:16}],[{type:3,h:18}],[{type:3,h:19}],[{type:2,h:20},{type:1,h:17}]]],[[[{type:3,h:10}],[{type:3,h:10},{type:3,h:12},{type:3,h:14},{type:3,h:16},{type:3,h:18}],[{type:3,h:10},{type:3,h:19}],[{type:3,h:10},{type:1,h:13},{type:1,h:16},{type:2,h:19}],[{type:3,h:10},{type:3,h:19}],[{type:3,h:10},{type:3,h:12},{type:3,h:14},{type:3,h:16},{type:3,h:18}],[{type:3,h:10}]],[[{type:3,h:10},{type:3,h:12},{type:3,h:14},{type:3,h:16}],[{type:3,h:10},{type:3,h:16}],[{type:2,h:10},{type:1,h:13},{type:1,h:16}],[{type:3,h:10},{type:3,h:16}],[{type:3,h:10},{type:3,h:12},{type:3,h:14},{type:3,h:16}]],[[{type:3,h:10},{type:3,h:12},{type:3,h:14},{type:3,h:16},{type:3,h:19}],[{type:3,h:10},{type:3,h:20},{type:1,h:13},{type:1,h:18},{type:3,h:15}],[{type:3,h:10},{type:2,h:15},{type:3,h:17}],[{type:3,h:10},{type:1,h:14}],[{type:3,h:10}]]],[[[{type:1,h:11}],[{type:1,h:12.5},{type:3,h:9}],[{type:1,h:7},{type:3,h:11},{type:1,h:15}],[{type:1,h:9},{type:1,h:17.5},{type:3,h:13}],[{type:2,h:14}]],[[{type:1,h:10},{type:1,h:15},{type:1,h:20}],[{type:3,h:10},{type:3,h:15},{type:3,h:20}],[{type:3,h:10},{type:2,h:15},{type:3,h:20}],[{type:3,h:10},{type:3,h:15},{type:3,h:20}],[{type:1,h:10},{type:1,h:15},{type:1,h:20}]],[[{type:1,h:10},{type:1,h:13},{type:1,h:16},{type:1,h:19}],[{type:3,h:10},{type:3,h:13},{type:3,h:16},{type:3,h:19}],[{type:2,h:10},{type:3,h:13},{type:3,h:16},{type:3,h:19}],[{type:3,h:10},{type:3,h:13},{type:3,h:16},{type:3,h:19}],[{type:1,h:10},{type:1,h:13},{type:1,h:16},{type:1,h:19}]]]],da=new THREE.Clock;c()}();
