!function(){"use strict";function a(){K=new THREE.Scene,L=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,3e3),L.position.z=-4,L.position.x=60,L.position.y=11,L.lookAt({x:0,y:5,z:-3}),M=new THREE.WebGLRenderer,M.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(M.domElement),O=new THREE.PointLight(11184810,.75),O.position.set(-50,100,0),O.position.multiplyScalar(300),K.add(O),N=new THREE.AmbientLight(10066329),K.add(N),f(K),g(),i(),j(),l(),k(),m(),h(),window.addEventListener("resize",b,!1),$(window).keydown(function(a){32==a.which&&X>=W&&(V?ka>0&&(U.play(),B&&B.position.y<40&&(aa=ka>0?ba>90||-90>ba?.3:.2:-.2)):($("#ui-start").hide(),V=!0,e()))}),$(window).keyup(function(a){32==a.which&&(U.pause(),aa=-.2)}),V=!1,c()}function b(){L.aspect=window.innerWidth/window.innerHeight,L.updateProjectionMatrix(),M.setSize(window.innerWidth,window.innerHeight)}function c(){requestAnimationFrame(c);var a=na.getDelta();THREE.AnimationHandler.update(3*a),V&&x(),M.render(K,L)}function d(){X++,X>=W&&($("#loading").fadeOut(),$("#score").fadeIn(),n(),y())}function e(){for(var a=0;a<Y.length;a++)for(var b=0;b<Y[a].length;b++)K.remove(Y[a][b].element);Y.length=0,ea=0,fa=0,ga=0,ha=0,ia=0,n(),B.position.y=8,B.scale.set(.5,.5,.5),B.position.x=ca,B.rotation.y=Math.PI,ba=0,_=0,ja=0,ka=100,$("#show")[0].innerHTML="0"}function f(a){var b=["images/pics/0004.png","images/pics/0002.png","images/pics/0006.png","images/pics/0005.png","images/pics/0001.png","images/pics/0003.png"],c=THREE.ImageUtils.loadTextureCube(b);c.format=THREE.RGBFormat;var d=THREE.ShaderLib.cube;d.uniforms.tCube.value=c;var e=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms,depthWrite:!1,side:THREE.BackSide});D=new THREE.Mesh(new THREE.BoxGeometry(1e3,1e3,1e3),e),a.add(D)}function g(){var a=new THREE.JSONLoader;a.load("images/model/plane.json",function(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.skinning=!0}B=new THREE.SkinnedMesh(a,new THREE.MeshFaceMaterial(b)),B.position.y=8;var f=new THREE.Animation(B,B.geometry.animations[0]);f.play(),B.scale.set(.5,.5,.5),B.position.x=ca,B.rotation.y=Math.PI,K.add(B),d()})}function h(){$.getJSON("images/map/map.json",function(a){P=a,d()})}function i(){var a=new THREE.JSONLoader;a.load("images/model/island.json",function(a,b){C=new THREE.Mesh(a,new THREE.MeshFaceMaterial(b)),C.scale.set(10,10,10),C.position.y=-5,K.add(C),d()})}function j(){var a=new THREE.JSONLoader;a.load("images/model/bonus.json",function(a,b){I=a,J=new THREE.MeshFaceMaterial(b),d()})}function k(){var a=new THREE.JSONLoader;a.load("images/model/stone.json",function(a,b){E=a,F=new THREE.MeshFaceMaterial(b),d()})}function l(){var a=new THREE.JSONLoader;a.load("images/model/point.json",function(a,b){G=a,H=new THREE.MeshFaceMaterial(b),d()})}function m(){Q=document.createElement("audio"),Q.src="images/music/note_2.mp3",R=document.createElement("audio"),R.src="images/music/megagem_6.mp3",S=document.createElement("audio"),S.src="images/music/cloud_hit.mp3",T=document.createElement("audio"),T.src="images/music/ground_hit.mp3",U=document.createElement("audio"),U.src="images/music/engine.mp3",U.setAttribute("loop",!0)}function n(){for(var a=0;130>a;a++){var b=new THREE.Mesh(E,F);b.position.x=ca*Math.cos(2*Math.PI*a/130),b.position.z=ca*Math.sin(2*Math.PI*a/130),b.position.y=-10,K.add(b);var c={type:1,element:b},d=[];d.push(c),Y.push(d)}}function o(){50>ja?0!=ea&&(ea=0,ha=0):130>ja?1!=ea&&(ea=1,ha=0):2!=ea&&(ea=2,ha=0)}function p(){ka-=.03,ma.fillStyle="#000000",ma.fillRect(0,0,300,200),ma.fillStyle="#FF0000",ma.fillRect(0,0,3*ka,200),ka>10?$("#no-fuel").hide():$("#no-fuel").show(),0>ka&&(ka=0),ka>100&&(ka=100)}function q(){_+=aa,aa>=.3&&-2.5>_?_=-2.5:aa>=.3&&_>2.5?_=2.5:ba>90&&_>1&&0>aa?_=1:-1>_?_=-1:_>1.5&&(_=1.5),ba>=-90&&90>=ba?ba+=_:(ba+=Math.abs(_),ba>=180&&(ba=-179)),0>aa&&ba>=-90+_&&-90-_>=ba&&(ba=-90)}function r(){B.position.y+=Math.sin(ba*Math.PI/180)*Z,B.position.y<=0&&(B.position.y=0,z()),B.rotation.x=ba*Math.PI/180,(B.rotation.z>=.1||B.rotation.z<=-.1)&&(da=-da);var a=Math.min(.001,Math.max(5e-4,(.1-Math.abs(B.rotation.z))/.1*.005));B.rotation.z+=da*a}function s(){var a=1.1*B.position.y;0>a&&(a=0),L.position.y=a}function t(){C.rotation.y-=Math.atan(Z*Math.cos(ba*Math.PI/180)/ca)}function u(){O.position.x=50*-Math.cos(C.rotation.y),O.position.z=50*Math.sin(C.rotation.y)}function v(a){for(var b=Math.cos(C.rotation.y+2*Math.PI*a/Y.length),c=Math.sin(C.rotation.y+2*Math.PI*a/Y.length),d=0;d<Y[a].length;d++)Y[a][d].element.position.x>48&&Y[a][d].element.position.z>-2&&Y[a][d].element.position.z<2&&(1==Y[a][d].type&&Math.abs(Y[a][d].element.position.y-B.position.y)<1.5||2==Y[a][d].type&&Math.abs(Y[a][d].element.position.y-B.position.y)<1||3==Y[a][d].type&&Math.abs(Y[a][d].element.position.y-B.position.y)<1)?(3==Y[a][d].type?ja++:1==Y[a][d].type?ka-=10:ka+=10,$("#show")[0].innerHTML=ja,K.remove(Y[a][d].element),A(Y[a][d]),Y[a].splice(d,1)):(Y[a][d].element.position.x=-b*ca,Y[a][d].element.position.z=c*ca,Y[a][d].element.rotation.y=C.rotation.y+2*Math.PI*a/Y.length+Math.PI)}function w(a){var b=Math.cos(C.rotation.y+2*Math.PI*a/Y.length),c=Math.sin(C.rotation.y+2*Math.PI*a/Y.length);if(-40>-b*ca&&10>c*ca&&c*ca>0&&Y[a].length>0){for(var d=0;d<Y[a].length;d++)K.remove(Y[a][d].element);Y[a].length=0}else if(-40>-b*ca&&c*ca>-10&&0>c*ca&&0==Y[a].length)if(4>=ha){var e=new THREE.Mesh(E,F);K.add(e);var f={type:1,element:e};e.position.y=-10,Y[a].push(f),ha++}else if(P[ea][fa].length<=ga)ha=0,fa=Math.floor(Math.random()/.34),ga=0,ia=6*(Math.random()-.5);else{for(var g=0;g<P[ea][fa][ga].length;g++){var h,i;1==P[ea][fa][ga][g].type?(h=new THREE.Mesh(E,F),K.add(h),i={type:1,element:h}):2==P[ea][fa][ga][g].type?(h=new THREE.Mesh(I,J),K.add(h),i={type:2,element:h}):(h=new THREE.Mesh(G,H),K.add(h),i={type:3,element:h}),h.position.y=P[ea][fa][ga][g].h+ia,Y[a].push(i)}ga++}}function x(){if(o(),p(),V&&q(),X>=W){for(var a=0;a<Y.length;a++)w(a),v(a);u(),r(),s(),t()}}function y(){var a=$("#ui-start");$("#no-fuel").hide(),a.fadeIn()}function z(){V=!1,T.play(),y()}function A(a){3==a.type?Q.play():2==a.type?R.play():S.play()}var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W=6,X=0,Y=[],Z=.15,_=0,aa=-1,ba=0,ca=50,da=1,ea=0,fa=0,ga=0,ha=0,ia=0,ja=0,ka=100,la=document.getElementById("bar"),ma=la.getContext("2d"),na=new THREE.Clock;a()}();